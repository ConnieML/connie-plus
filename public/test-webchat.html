<!DOCTYPE html>
<html>
<head>
    <title>WebChat Test</title>
</head>
<body>
    <h1>WebChat Test</h1>
    <div id="twilio-webchat-widget-root"></div>
    
    <script defer src="https://media.twiliocdn.com/sdk/js/webchat-v3/releases/3.3.0/webchat.min.js" 
            integrity="sha256-ydLLXnNrb26iFUvKAHsYt9atwfzz0LNcgBmo0NmD5Uk=" 
            crossorigin="anonymous"></script>
    <script>
        window.addEventListener("load", () => {
            console.log('Page loaded');
            console.log('Twilio available:', !!window.Twilio);
            console.log('Twilio keys:', window.Twilio ? Object.keys(window.Twilio) : 'none');
            
            // Detect which organization is requesting support from the parent window
            let organizationName = 'Unknown';
            try {
                const referrer = document.referrer;
                if (referrer.includes('nss.connie.team')) organizationName = 'NSS';
                else if (referrer.includes('hhovv.connie.team')) organizationName = 'HHOVV';
                else if (referrer.includes('dev.connie.team')) organizationName = 'DevSandbox';
                else if (referrer.includes('localhost')) organizationName = 'Development';
            } catch (e) {
                console.log('Could not detect organization, defaulting to NSS');
                organizationName = 'NSS';
            }
            
            const deploymentKey = 'CVd30e7280b3cd760a06c6aa0ab44bb13b'; // Parent Care Team deployment key
            
            console.log(`Detected organization: ${organizationName}`);
            console.log(`Using Care Team deployment key: ${deploymentKey}`);
            
            if (window.Twilio && window.Twilio.initWebchat) {
                const appConfig = {
                    deploymentKey: deploymentKey,
                    context: {
                        organization: organizationName,
                        source: 'enhanced_crm_container'
                    }
                }
                console.log(`Initializing WebChat for ${organizationName} via single support channel...`);
                window.Twilio.initWebchat(appConfig);
                console.log('WebChat initialized with dynamic organization context!');
            } else {
                console.error('WebChat not available');
            }
        })
    </script>
</body>
</html>