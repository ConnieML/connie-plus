<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSS WebChat Support</title>
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
        .header { text-align: center; margin-bottom: 20px; }
        .org-info { background: #e8f4fd; padding: 10px; border-radius: 5px; margin-bottom: 20px; text-align: center; }
    </style>
</head>
<body>
    <div class="header">
        <h2>NSS Live Chat Support</h2>
    </div>
    
    <div class="org-info">
        <strong>Organization:</strong> Nevada Senior Services (NSS)<br>
        <strong>Access:</strong> Enhanced CRM Container Only
    </div>

    <!-- Twilio WebChat 3.0 -->
    <script src="https://media.twiliocdn.com/sdk/js/conversations/releases/3.4.1/twilio-conversations.min.js"></script>
    <script src="https://assets.flex.twilio.com/releases/webchat-ui/3.1.10/twilio-flex-webchat.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('NSS WebChat initializing...');
            
            // Security check - only allow from NSS Enhanced CRM Container
            const referrer = document.referrer;
            console.log('Referrer:', referrer);
            
            if (!referrer.includes('nss.connie.team') && !referrer.includes('localhost')) {
                document.body.innerHTML = `
                    <div style="padding: 40px; text-align: center; color: #d32f2f;">
                        <h2>üîí Access Restricted</h2>
                        <p>NSS WebChat is only available through the NSS Enhanced CRM Container.</p>
                        <p>Please access through: <strong>nss.connie.team</strong></p>
                    </div>
                `;
                return;
            }
            
            // NSS-specific configuration
            const organizationName = 'NSS';
            const deploymentKey = 'CV8c8c75ecb84c0208b1166dbe53bdb81a'; // NSS WebChat
            
            console.log(`Initializing WebChat for ${organizationName}`);
            console.log(`Using deployment key: ${deploymentKey}`);
            
            if (window.Twilio && window.Twilio.initWebchat) {
                const appConfig = {
                    deploymentKey: deploymentKey,
                    context: {
                        organization: organizationName,
                        referrer: referrer,
                        source: 'enhanced_crm_container_nss',
                        page: 'nss-webchat'
                    }
                }
                console.log(`NSS WebChat initialized with context:`, appConfig.context);
                window.Twilio.initWebchat(appConfig);
            } else {
                console.error('WebChat not available');
                document.body.innerHTML += '<div style="text-align: center; color: #d32f2f; margin-top: 20px;">‚ùå WebChat failed to load</div>';
            }
        })
    </script>
</body>
</html>